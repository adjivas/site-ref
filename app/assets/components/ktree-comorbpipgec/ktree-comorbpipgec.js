        Polymer({
            is: "ktree-comorbpipgec",
            properties: {
                steps: {
                    type: Array,
                    value: function () {
                        return [
                            {
                                name: "Les programmes d’interventions personnalisés, globaux et coordonnés",
                                presentation: '<p>La description suivante des interventions est extraite des recommandations de bonnes pratiques professionnelles publiées en 2012 par la HAS et l’ANESM. Pour en savoir plus, il est vivement conseillé de se reporter à ces recommandations.</p>            <p>Les interventions personnalisées, globales et coordonnées recommandées sont fondées sur une approche éducative, comportementale et développementale et présentent les caractéristiques suivantes. Elles sont :</p><ul><li><p><b>précoces :</b> elles débutent entre l’âge de dix-huit mois et l’âge de quatre ans pour des enfants avec diagnostic de TSA ou pour lesquels un TSA est suspecté (troubles du développement pouvant évoluer vers un TSA) et durent au minimum deux ans </p></li><li><p><b>personnalisées </b> et définies en fonction de l’évaluation initiale et continue du développement et du comportement de l’enfant suivi en tenant compte du développement typique dans les différents domaines ;</p></li><li><p><b>fondées sur des objectifs fonctionnels </b> à court et moyen terme, ajustés au cours d’échanges entre la famille, les professionnels qui mettent en œuvre les interventions et ceux qui en assurent la supervision ; les interventions visent au minimum l’imitation, le langage, la communication, le jeu, les capacités d’interactions sociales, l’organisation motrice, la planification des actions, les capacités adaptatives des comportements dans la vie quotidienne et comportent des stratégies pour prévenir ou réduire la fréquence ou les conséquences des comportements-problèmes ; elles tiennent compte également des domaines émotionnel et sensoriel  </p></li><li><p><b>attentives constamment à promouvoir la généralisation et le transfert des acquis</b>  à des situations nouvelles avec une transition graduelle vers des environnements, notamment sociaux, de plus en plus larges et ordinaires  </p></li><li><p><b>mises en oeuvre par une équipe formée et régulièrement supervisée</b> par des professionnels qualifiés et expérimentés utilisant un mode commun de communication et d’interactions avec l’enfant. Les recommandations insistent également sur le fait qu’une intervention globale ne peut pas consister en une juxtaposition de pratiques éducatives, pédagogiques, rééducatives ou psychologiques avec des techniques très hétérogènes ou éclectiques.</p></li></ul><p>Pour observer des résultats efficaces, vingt-cinq heures d’interventions par semaine (temps de scolarisation avec accompagnement individuel adapté inclus) sont requises au minimum. Ces durées, qui respectent les rythmes physiologiques du sommeil en fonction de l’âge, comprennent les temps de scolarisation avec accompagnement individuel adapté et visent à faciliter l’accueil de l’enfant en crèche ou à l’école pour des durées progressivement croissantes en fonction de l’âge et de la capacité de l’enfant.</p><p>L’adaptation et la structuration de l’environnement matériel aux particularités de l’enfant (espace, temps, environnement sonore…) sont également recommandées.</p><div class="bgvertf"><p>Les interventions fondées sur un niveau de validation scientifique suffisant sont : l’analyse appliquée du comportement dite « ABA », le programme développemental dit « de Denver » ou le programme « Traitement et éducation pour enfants avec autisme ou handicap de la communication » dit « TEACCH ». Les prises en charge intégratives de type thérapie d’échange et de développement, en tant qu’interventions fondées sur une approche développementale intégrant des principes neurophysiologiques et de rééducation, sont jugées appropriées.</p><p>Les prises en charge intégratives, fondées sur les besoins individuels de l’enfant identifiés lors de l’évaluation du fonctionnement et conçues de manière transdisciplinaire pour permettre à l’enfant de rester intégré dans son milieu de vie ordinaire, sont également jugées appropriées dès lors que les critères développés ci-dessus sont respectés et en particulier que les professionnels, quel que soit leur mode d’exercice, veillent à utiliser un mode de communication et d’interaction commun et à ne pas disperser l’enfant/adolescent dans des activités éclectiques ou des lieux multiples.</p></div><p>Au-delà de quatre ans, les recommandations soulignent que la mise en place ou la poursuite des interventions s’effectue selon des dispositifs différents, en fonction du profil de développement de l’enfant et de la sévérité des symptômes. Des interventions spécifiques focalisées sur un ou deux domaines particuliers peuvent être proposées, soit isolément si l’enfant ne présente pas de déficience intellectuelle associée, soit en complément des interventions globales proposées si l’enfant présente un faible niveau de développement de la communication, des interactions sociales et du fonctionnement cognitif, ou s’il présente une grande hétérogénéité des niveaux de compétences par domaine. Les recommandations précisent que ces interventions globales comportent toutes une scolarisation, en privilégiant la scolarisation en milieu ordinaire avec un accompagnement éducatif et thérapeutique individuel à l’école et au domicile, notamment pour les enfants présentant un niveau de développement intellectuel moyen ou bon, des symptômes d’autisme d’intensité modérée et un langage fonctionnel.</p><p>À l’inverse, chez les très jeunes enfants, avant l’âge de quatre ans et dès l’âge de douze mois, l’Early Start Denver Model (ESDM) apparaît adapté, et son efficacité a été démontrée dans des études randomisées contrôlées, avec une amélioration significative des compétences cognitives, sociocommunicatives et langagières des enfants (Rogers et al., 2012, Vivanti et al., 2014). Ce programme prend la forme de séances individuelles avec les parents et l’enfant et a pour objectif de stimuler le développement sociocommunicatif de celui-ci dans toutes les situations de la vie quotidienne à travers la formation des parents et la guidance parentale. La guidance éducative des parents est particulièrement intéressante, car elle permet de travailler avec les parents et l’enfant en situation écologique, dans le milieu de vie de l’enfant, au travers de toutes les situations de la vie quotidienne permettant de stimuler le développement de l’enfant (par exemple, le repas, le change, l’habillage).</p>',
                                pos: [4, 7],
                                enfant: "ktree-igc",
                            },
                            {
                                name: "Les interventions de nature éducative, comportementale et développementales",
                                presentation: "<p>Les interventions recommandées pour les enfants par la HAS et l’ANESM en 2012 le sont également pour les adultes, dans l’attente de recommandations spécifiques.</p>",
                                pos: [2, 5],
                                enfant: "ktree-ieducom",
                            },
                            {
                                name: "Les interventions non recommandées",
                                presentation: "<p>L’absence de données sur leur efficacité, le caractère exclusif de leur application et leur absence de fondement théorique ont conduit les experts, professionnels et représentants d’usagers, à ne pas recommander les pratiques suivantes (accord d’experts) :</p><ul><li> <b>le programme Son Rise</b>, se caractérisant par une intervention à domicile centrée sur l’enfant et administrée par les parents. </li><li><b>la méthode des 3i</b>, s’inspirant de l’approche Son Rise, avec des règles spécifiques et plus strictes sur certains aspects tels que le caractère intensif (quarante heures) obligatoire, qui prône également une déscolarisation de l’enfant pendant un ou deux ans.</li><li> <b>la méthode Feuerstein</b> visant à accompagner l’enfant dans ses tâches en lui fixant un but, de sorte qu’il comprenne le raisonnement utilisé et qu’il s’en serve dans les activités de la vie quotidienne .</li><li> <b>la méthode Padovan ou réorganisation neuro-fonctionnelle</b>, approche thérapeutique s’appuyant sur le concept de l’organisation neurologique .</li><li> <b>la méthode Floortime ou Greenspan</b>, non recommandée en tant que méthode exclusive ; en revanche, cette approche basée sur la stimulation par le jeu peut présenter un intérêt lorsqu’elle est proposée au sein d’un projet d’interventions coordonnées .</li><li><b>la méthode Doman-Delacato</b>, consistant à reproduire l’évolution phylogénétique des schémas de locomotion .</li><li>le recours au mélange gazeux dioxyde de carbone-oxygène associé à une méthode précédente.</li></ul><p>Par ailleurs, s’agissant de la pratique des enveloppements corporels humides (dits packing), en l’absence de données relatives à son efficacité ou à sa sécurité, du fait des questions éthiques soulevées par cette pratique et de l’indécision des experts en raison d’une extrême divergence de leurs avis, les recommandations conjointes HAS-ANESM de 2012 indiquent qu’il n’est pas possible de conclure à la pertinence d’éventuelles indications, même restreintes à un recours ultime et exceptionnel. En dehors de protocoles de recherche autorisés respectant la totalité des conditions définies par le Haut Conseil de la santé publique (HCSP), la HAS et l’ANESM sont formellement opposées à l’utilisation de cette pratique.</p>",
                                pos: [4, 5],
                                enfant: "",
                            },
                            {
                                name: "Les interventions non consensuelles",
                                presentation: "<p>L’absence de données scientifiques sur leur efficacité et la divergence des avis exprimés ne permettent pas de conclure à la pertinence des interventions fondées sur les approches <b>psychanalytiques</b> et la <b>psychothérapie institutionnelle</b> pour accompagner les personnes présentant un TSA vers une vie plus autonome.</p>",
                                pos: [6, 5],
                                enfant: "",
                            }
                        ]
                    }
                },
                connect: {
                    type: Array,
                    value: function () {
                        return [
                            //[parent, child, mode]
                            [
                                "Les programmes d’interventions personnalisés, globaux et coordonnés", "Les interventions de nature éducative, comportementale et développementales", 0
                            ],
                            [
                                "Les programmes d’interventions personnalisés, globaux et coordonnés", "Les interventions non recommandées", 0
                            ],
                            [
                                "Les programmes d’interventions personnalisés, globaux et coordonnés", "Les interventions non consensuelles", 0
                            ]
                        ]
                    }
                },
                dimensions: {
                    type: Array,
                    value: function () {
                        return [11, 10]
                    }
                }
            },

            width: window.innerWidth * 3 / 5,
            height: null,
            nodeColorNeutral: "#226070",
            nodeColorSuccess: "#8FB0B9",
            nodeColorFail: "red",
            strokeColorNeutral: "#8FB0B9",
            strokeColorSuccess: "#fff",
            strokeColorFail: "red",
            strokeColorCurrent: "#00babc",


            showKtree: function (ktree) {
                console.log("j'aime pas les arbres");
                console.log(ktree);
                document.getElementById('container').innerHTML = "<" + ktree + "></" + ktree + ">";
                document.getElementById("ktreetext").innerHTML = " ";
                document.getElementById("ktreebouton").innerHTML = " ";
            },

            addNode: function(obj, coeff, layer, i) {
                var nodeColor;
                var strokeColor;
                if (obj.enfant != "") {
                    nodeColor = this.nodeColorNeutral;
                    strokeColor = this.strokeColorNeutral;
                } else if (obj.enfant == "") {
                    nodeColor = this.nodeColorNeutral;
                    strokeColor = this.strokeColorSuccess;
                }
                var node = new Konva.Circle({
                    x: obj.pos[0] * coeff,
                    y: obj.pos[1] * coeff,
                    radius: coeff / 2,
                    fill: nodeColor,
                    stroke: strokeColor,
                    id: obj.name,
                    text: obj.name,
                    strokeWidth: coeff / 12
                });
                layer.add(node);
                if (obj.enfant == "") {
                    node.on('click', function () {
                        document.getElementById("ktreetext").innerHTML = "<h2>" + obj.name + ": </h2>" + "<p>" + obj.presentation + "</p><br/>";
                        document.getElementById("ktreebouton").innerHTML = "";
                    });
                    node.on('mouseover', function () {
                        this.opacity(0.5);
                        document.body.style.cursor = 'pointer';
                        layer.draw();
                    });
                    node.on('mouseleave', function () {
                        this.opacity(1);
                        document.body.style.cursor = 'default';
                        layer.draw();
                    });
                } else {
                    node.on('dblclick', function() {
                        document.querySelector('ktree-selector').showKtree(obj.enfant);
                    });
                    node.on('click', function () {
                        document.getElementById("ktreetext").innerHTML = "<h2>" + obj.name + ": </h2>" + "<p>" + obj.presentation + "</p><br/>";
                        document.getElementById("ktreebouton").innerHTML = "<a><button onClick=\"document.querySelector('ktree-selector').showKtree('" + obj.enfant + "')\">En savoir plus</button></a>";
                    });
                    node.on('mouseover', function () {
                        this.opacity(0.5);
                        document.body.style.cursor = 'pointer';
                        layer.draw();
                    });
                    node.on('mouseleave', function () {
                        this.opacity(1);
                        document.body.style.cursor = 'default';
                        layer.draw();
                    });
                }
            },

            addConnect: function (connect, layer, i, coeff) {
                var node1 = layer._getNodeById(connect[0]);
                var node2 = layer._getNodeById(connect[1]);
                var x1, y1, x2, y2, h;
                h = Math.sqrt(Math.pow(node1.x() - node2.x(), 2) + Math.pow(node1.y() - node2.y(), 2));
                x1 = Math.abs(node1.x() + ((node1.radius() + node1.strokeWidth() / 2) * ((node2.x() - node1.x()) / h)));
                y1 = Math.abs(node1.y() + ((node1.radius() + node1.strokeWidth() / 2) * ((node2.y() - node1.y()) / h)));
                x2 = Math.abs(node2.x() + ((node1.radius() + node1.strokeWidth() / 2) * ((node1.x() - node2.x()) / h)));
                y2 = Math.abs(node2.y() + ((node1.radius() + node1.strokeWidth() / 2) * ((node1.y() - node2.y()) / h)));
                var line = new Konva.Line({
                    points: [x1, y1, x2, y2],
                    stroke: 'white',
                    strokeWidth: coeff / 12,
                });
                layer.add(line);
            },

            drawConnect: function (layer, coeff) {
                for (var i = 0; i < this.connect.length; i++) {
                    this.addConnect(this.connect[i], layer, i, coeff);
                }
            },

            drawNodes: function () {
                console.log("j'aime les arbres");
                var coeff = this.width / this.dimensions[0];
                this.height = coeff * this.dimensions[1];
                var stage = new Konva.Stage({
                    container: "container",
                    width: this.width,
                    height: this.height
                });
                var layer = new Konva.Layer();
                for (var i = 0; i < this.steps.length; i++) {
                    this.addNode(this.steps[i], coeff, layer, i);
                }
                this.drawConnect(layer, coeff);
                stage.add(layer);
            },

            ready: function () {
                this.drawNodes();
            }
 });
